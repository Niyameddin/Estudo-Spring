/*!
 * estudo-spring v1.2.2-RC4 (http://github.com/gsag/estudo-spring)
 * 15/11/2015 Guilherme Alves <gsag.dh@gmail.com>
 * Licensed under the MIT license
 */
!function(){"use strict";angular.module("bookcaseApp",["ui.router","ngStorage","ui.mask","restangular","ngMessages","angularUtils.directives.dirPagination"]),angular.module("bookcaseApp").constant("$config",{baseUrl:"http://localhost:9090",bookApi:"/bookcase/api/",projectName:"Estudo-Spring"}),angular.module("bookcaseApp").config(function($stateProvider,$urlRouterProvider,$config,RestangularProvider){RestangularProvider.setBaseUrl($config.baseUrl+$config.bookApi),$stateProvider.state("bookcase",{url:"/bookcase",templateUrl:"assets/views/partial-bookcase.html",controller:"bookcaseController"}).state("books",{url:"/bookcase/books",templateUrl:"assets/views/partial-books.html",controller:"bookcaseController"}).state("register",{url:"/bookcase/register",templateUrl:"assets/views/partial-register-book.html",controller:"registerBookController"}),$urlRouterProvider.otherwise("/bookcase")}).run(function($state){$state.go("bookcase")})}(),function(){"use strict";angular.module("bookcaseApp").controller("bookcaseController",function($scope,bookcaseService,$localStorage,HTTPCache,$state,$stateParams){$scope.errorMessage="",$scope.books=[],$scope.hasBooks=!0,$scope.flashMessage="",$scope.preUpdatedModel={},$scope.searchText="",$scope.pagination={currentPage:1,pageSize:5};var hasBooksLoaded=(function(){bookcaseService.getBooks().then(function(data){for(var i=0;i<data.length;i++)$scope.books.push(data[i])},function(error){$scope.errorMessage="Aconteceu um problema ao resgatar os dados do servidor. Tente novamente mais tarde. "})["finally"](function(){hasBooksLoaded(),loadLocalFlashMessage(),cacheInit()})}(),function(){0===$scope.books.length?$scope.hasBooks=!1:$scope.hasBooks=!0}),loadLocalFlashMessage=function(){$scope.flashMessage=$localStorage.flashMessage,delete $localStorage.flashMessage},removeFromBookList=function(index){index>-1&&$scope.books.splice(index,1),hasBooksLoaded()};$scope.deleteBook=function(book){bookcaseService.deleteBook(book.isbn).then(function(response){var successResponse=response[Object.keys(response)[0]];$localStorage.flashMessage=successResponse;var index=$scope.books.indexOf(book);removeFromBookList(index),$state.transitionTo($state.current,$stateParams,{reload:!0,inherit:!1,notify:!0})},function(error){$scope.errorMessage="Aconteceu um problema ao resgatar os dados do servidor. Tente novamente mais tarde. "})},$scope.copyBookModel=function(book){$scope.preUpdatedModel=bookcaseService.copyBook(book)},$scope.updateBook=function(book){bookcaseService.updateBook(book).then(function(response){var successResponse=response[Object.keys(response)[0]];$localStorage.flashMessage=successResponse})["finally"](function(){$("#modalEdicao").modal("hide"),$("#modalEdicao").on("hidden.bs.modal",function(event){$state.transitionTo($state.current,$stateParams,{reload:!0,inherit:!1,notify:!0})})})};var cacheInit=function(){return HTTPCache.init()}})}(),function(){"use strict";angular.module("bookcaseApp").controller("navigationController",function($scope,$config){$scope.appName=$config.projectName,$scope.baseUrl=$config.baseUrl})}(),function(){"use strict";angular.module("bookcaseApp").controller("registerBookController",function($scope,$state,$localStorage,bookcaseService){$scope.newBook={isbn:"",title:"",author:"",edition:""},$scope.responseStyle="",$scope.response={};var resetFields=function(){return{isbn:"",title:"",author:"",edition:""}};$scope.registerNewBook=function(book){bookcaseService.createBook(book).then(function(response){var successResponse=response[Object.keys(response)[0]];$scope.newBook=resetFields(),$localStorage.flashMessage=successResponse,$state.transitionTo("books")},function(failedResponse){if(failedResponse.data){var badResponse=failedResponse.data[Object.keys(failedResponse.data)[0]];"WARNING"==badResponse.status?($scope.responseStyle="alert alert-warning",$scope.response=failedResponse.data):"ERROR"==badResponse.status&&($scope.responseStyle="alert alert-danger",$scope.response=failedResponse.data)}else $scope.responseStyle="alert alert-danger",$scope.response={0:{status:"NULL",objectType:"null",objectAttributes:"null",defaultMessage:"Houve um problema ao receber a resposta do servidor.Tente novamente daqui alguns instantes."}}})}})}(),function(){"use strict";angular.module("bookcaseApp").directive("ngHref",["$config",function($config){return function(scope,element,attrs){function ngHref(event){event.target.href=$config.baseUrl+$config.bookApi+"books"}element.bind("click",ngHref)}}])}(),function(){"use strict";angular.module("bookcaseApp").factory("BookApi",function(Restangular){var _getAll=function(){return Restangular.all("books")},_getOne=function(path,param){return Restangular.one(path,param)},_copy=function(original){return Restangular.copy(original)};return{getAll:_getAll,getOne:_getOne,copy:_copy}})}(),function(){"use strict";angular.module("bookcaseApp").factory("HTTPCache",["Restangular","$cacheFactory",function(Restangular,$cacheFactory){var cache,service={};return service.init=function(){cache=$cacheFactory("http"),Restangular.setDefaultHttpFields({cache:cache}),Restangular.setResponseInterceptor(function(response,operation){return("put"===operation||"post"===operation||"remove"===operation)&&cache.removeAll(),response})},service}])}(),function(){"use strict";angular.module("bookcaseApp").service("bookcaseService",function(BookApi){var _getBooks=function(){return BookApi.getAll().getList()},_getBook=function(book){return BookApi.getOne("books",book.isbn).get()},_createBook=function(newBook){return BookApi.getAll().post(newBook)},_deleteBook=function(isbn){return BookApi.getOne("delete",isbn).remove()},_updateBook=function(book){return book.put()},_copyBook=function(original){return BookApi.copy(original)};return{getBooks:_getBooks,getBook:_getBook,createBook:_createBook,deleteBook:_deleteBook,updateBook:_updateBook,copyBook:_copyBook}})}();
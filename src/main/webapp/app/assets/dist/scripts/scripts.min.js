/*!
 * estudo-spring v1.2.0 (http://github.com/gsag/estudo-spring)
 * 14/10/2015 Guilherme Alves <gsag.dh@gmail.com>
 * Licensed under the MIT license
 */
!function(){"use strict";angular.module("bookcaseApp",["ui.router","ngStorage","ui.mask","restangular","ngMessages"]),angular.module("bookcaseApp").constant("$config",{baseUrl:"http://localhost:9090",bookApi:"/bookcase/api/",projectName:"Estudo-Spring"}),angular.module("bookcaseApp").config(function($stateProvider,$urlRouterProvider,$config,RestangularProvider){RestangularProvider.setBaseUrl($config.baseUrl+$config.bookApi),$stateProvider.state("bookcase",{url:"/bookcase",templateUrl:"assets/views/partial-bookcase.html",controller:"bookcaseController"}).state("books",{url:"/bookcase/books",templateUrl:"assets/views/partial-books.html",controller:"bookcaseController"}).state("register",{url:"/bookcase/register",templateUrl:"assets/views/partial-register-book.html",controller:"registerBookController"}),$urlRouterProvider.otherwise("/bookcase")}).run(function($state){$state.go("bookcase")})}(),function(){"use strict";angular.module("bookcaseApp").controller("bookcaseController",function($scope,bookcaseService,$localStorage,HTTPCache){$scope.errorMessage="",$scope.books={},$scope.hasBooks=!0,$scope.flashMessage="";var hasBooksLoaded=(function(){bookcaseService.getBooks().then(function(data){$scope.books=data},function(error){$scope.errorMessage="Aconteceu um problema ao resgatar os dados do servidor. Tente novamente mais tarde. "})["finally"](function(){hasBooksLoaded(),loadLocalFlashMessage(),HTTPCache.init()})}(),function(){0===$scope.books.length&&($scope.hasBooks=!1)}),loadLocalFlashMessage=function(){$scope.flashMessage=$localStorage.flashMessage,delete $localStorage.flashMessage}})}(),function(){"use strict";angular.module("bookcaseApp").controller("navigationController",function($scope,$config){$scope.appName=$config.projectName,$scope.baseUrl=$config.baseUrl})}(),function(){"use strict";angular.module("bookcaseApp").controller("registerBookController",function($scope,$state,$localStorage,bookcaseService){$scope.newBook={isbn:"",title:"",author:"",edition:""},$scope.responseStyle="",$scope.response={};var resetFields=function(){return{isbn:"",title:"",author:"",edition:""}};$scope.registerNewBook=function(book){bookcaseService.createBook(book).then(function(response){var successResponse=response[Object.keys(response)[0]];$scope.newBook=resetFields(),$localStorage.flashMessage=successResponse,$state.transitionTo("books")},function(failedResponse){if(failedResponse.data){var badResponse=failedResponse.data[Object.keys(failedResponse.data)[0]];"WARNING"==badResponse.status?($scope.responseStyle="alert alert-warning",$scope.response=failedResponse.data):"ERROR"==badResponse.status&&($scope.responseStyle="alert alert-danger",$scope.response=failedResponse.data)}else $scope.responseStyle="alert alert-danger",$scope.response={0:{status:"NULL",objectType:"null",objectAttributes:"null",defaultMessage:"Houve um problema ao receber a resposta do servidor.Tente novamente daqui alguns instantes."}}})}})}(),function(){"use strict";angular.module("bookcaseApp").directive("ngHref",["$config",function($config){return function(scope,element,attrs){function ngHref(event){event.target.href=$config.baseUrl+$config.bookApi+"books"}element.bind("click",ngHref)}}])}(),function(){"use strict";angular.module("bookcaseApp").factory("BookApi",function(Restangular){return Restangular.all("books")})}(),function(){"use strict";angular.module("bookcaseApp").factory("HTTPCache",["Restangular","$cacheFactory",function(Restangular,$cacheFactory){var cache,service={};return service.init=function(){cache=$cacheFactory("http"),Restangular.setDefaultHttpFields({cache:cache}),Restangular.setResponseInterceptor(function(response,operation){return("put"===operation||"post"===operation||"delete"===operation)&&cache.removeAll(),response})},service}])}(),function(){"use strict";angular.module("bookcaseApp").service("bookcaseService",function(BookApi){var _getBooks=function(){return BookApi.getList()},_createBook=function(newBook){return BookApi.post(newBook)};return{getBooks:_getBooks,createBook:_createBook}})}();